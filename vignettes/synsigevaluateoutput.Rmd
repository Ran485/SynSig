---
title: "Use SynSig to evaluate the output of signature extraction"
author: "Steve Rozen"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Use SynSig to evalute the output of signature extraction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

To evaluate / assess how well extracted signatures
reflect the ground-truth signatures that went into the 
synthetic data, do the following steps.  We take as the first
example SigProfiler output run on synthetic data based on
SigProfiler 96-channel mutational signature profiles and
SigProfiler attributions (exposures).


## SigProfiler example

We start by reading in the ground truth signature profiles,
the ground truth synthetic exposures, and the 
signature profiles extracted by SigProfiler.

We start with data in files because we assume
that signature extraction software is not integrated into
R.

We need the ICAMS package for reading signature profiles.

```{r readSPprofiles}
library(ICAMS)
library(SynSig)
getwd()
# setwd("vignettes/")

tmp.read.96 <- function(x) ReadCat96(x, strict = FALSE)

# debug(MatchSigsaAndRelabel)
SP.7.analysis <- 
  ReadAndAnalyzeSigs(
    extracted.sigs =
      "res_sp.sp.syn.2018.12.31.v2_signature_patterns_for_7_sigs.csv",
    ground.truth.sigs = "sigProfiler_SBS_signatures_2018_03_28.csv",
    ground.truth.exposures = "sp.syn.exposure.csv",
    read.ground.truth.sigs.fn = tmp.read.96)

SP.7.analysis$avg


```

```{r}
knitr::kable(
  SP.7.analysis$match1, 
  caption = 'Best matches from extracted to ground truth'
)

knitr::kable(
  SP.7.analysis$match2,
  caption = 'Best matches from ground truth to extracted'
)

```

Plot the input signatures.

```{r, fig.width = 5}

tmp <- 
  lapply(colnames(SP.7.analysis$gt.sigs),
        function(x) {
          PlotCat96(SP.7.analysis$gt.sigs[ ,x, drop = FALSE],
                       type = "signature",
                    grid = FALSE, xlabels = FALSE, cex = 0.6,
                    upper = FALSE)
        })
```
```{r, fig.width = 5}
tmp <- 
  lapply(colnames(SP.7.analysis$ex.sigs),
        function(x) {
          PlotCat96(SP.7.analysis$ex.sigs[ ,x, drop = FALSE],
                       type = "signature",
                    grid = FALSE, xlabels = FALSE, cex = 0.6,
                    upper = FALSE)
        })
```

Try again with 9 extracted signatures.

```{r, fig.width = 5}
SP.9.analysis <- 
  ReadAndAnalyzeSigs(
    extracted.sigs =
      "res_sp.sp.syn.2018.12.31.v2_signature_patterns_for_9_sigs.csv",
    ground.truth.sigs = "sigProfiler_SBS_signatures_2018_03_28.csv",
    ground.truth.exposures = "sp.syn.exposure.csv",
    read.ground.truth.sigs.fn = tmp.read.96)

SP.9.analysis$avg

```

```{r}
knitr::kable(
  SP.9.analysis$match1,
  caption = 'Best matches from extracted to ground truth'
)

knitr::kable(
  SP.9.analysis$match2, 
  caption = 'Best matches from ground truth to extracted'
)

```


```{r, fig.width = 5}
tmp <- 
  lapply(colnames(SP.9.analysis$gt.sigs),
        function(x) {
          PlotCat96(SP.9.analysis$gt.sigs[ ,x, drop = FALSE],
                       type = "signature",
                    grid = FALSE, xlabels = FALSE, cex = 0.6,
                    upper = FALSE)
        })
```

```{r, fig.width = 5}
tmp <- 
  lapply(colnames(SP.9.analysis$ex.sigs),
        function(x) {
          PlotCat96(SP.9.analysis$ex.sigs[ ,x, drop = FALSE],
                       type = "signature",
                    grid = FALSE, xlabels = FALSE, cex = 0.6,
                    upper = FALSE)
        })

```

# Session Info

```{r}
sessionInfo()
```
